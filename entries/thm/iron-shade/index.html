<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="keywords" content="Iron Shade, Iron Shade Write-Up, Iron Shade Writeup, Writeup, Writeups, ctf, Capture The Flag, TryHackMe, thm" />
  <title>Iron Shade</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        background-color: #232629;
        color: #7a7c7d;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #7a7c7d;  padding-left: 4px; }
    div.sourceCode
      { color: #cfcfc2; background-color: #232629; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #cfcfc2; } /* Normal */
    code span.al { color: #95da4c; background-color: #4d1f24; font-weight: bold; } /* Alert */
    code span.an { color: #3f8058; } /* Annotation */
    code span.at { color: #2980b9; } /* Attribute */
    code span.bn { color: #f67400; } /* BaseN */
    code span.bu { color: #7f8c8d; } /* BuiltIn */
    code span.cf { color: #fdbc4b; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #3daee9; } /* Char */
    code span.cn { color: #27aeae; font-weight: bold; } /* Constant */
    code span.co { color: #7a7c7d; } /* Comment */
    code span.cv { color: #7f8c8d; } /* CommentVar */
    code span.do { color: #a43340; } /* Documentation */
    code span.dt { color: #2980b9; } /* DataType */
    code span.dv { color: #f67400; } /* DecVal */
    code span.er { color: #da4453; text-decoration: underline; } /* Error */
    code span.ex { color: #0099ff; font-weight: bold; } /* Extension */
    code span.fl { color: #f67400; } /* Float */
    code span.fu { color: #8e44ad; } /* Function */
    code span.im { color: #27ae60; } /* Import */
    code span.in { color: #c45b00; } /* Information */
    code span.kw { color: #cfcfc2; font-weight: bold; } /* Keyword */
    code span.op { color: #cfcfc2; } /* Operator */
    code span.ot { color: #27ae60; } /* Other */
    code span.pp { color: #27ae60; } /* Preprocessor */
    code span.re { color: #2980b9; background-color: #153042; } /* RegionMarker */
    code span.sc { color: #3daee9; } /* SpecialChar */
    code span.ss { color: #da4453; } /* SpecialString */
    code span.st { color: #f44f4f; } /* String */
    code span.va { color: #27aeae; } /* Variable */
    code span.vs { color: #da4453; } /* VerbatimString */
    code span.wa { color: #da4453; } /* Warning */
  </style>
  <link rel="stylesheet" href="../../../css/style.css" />
  <script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
  <script src="../../../scripts/menu.js"></script>
  <script src="../../../scripts/terminal.js"></script>
  <script src="../../../scripts/images.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <link rel="icon" type="image/svg+xml" href="../../../img/favicon/favicon.svg">
</head>
<body>
<div class="logo">
<a href="http://aleksanderjozwik.com"><img src="../../../img/favicon/favicon-64.png" style="width:64px; display:block;"></a>
</div>

<!-- Navbar -->
<nav class="top-navigation">
  <ul>
    <li>
      <a href="https://aleksanderjozwik.com"><i class="fas fa-home"></i> Home</a>
    </li>

    <li>
      <a href="https://www.github.com/jozwikaleksander"><i class="fa-brands fa-github"></i> Github</a>
    </li>

    <li>
      <a href="../../../index.html"><i class="fas fa-book"></i> Write-Ups</a>
    </li>
  </ul>
</nav>
<header id="title-block-header">
<h1 class="title">Iron Shade</h1>
<p class="date"><i class="fa-solid fa-calendar"></i> Creation date:<span style='opacity:0;'>_</span>17.08.2024</p>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#what-is-the-machine-id-of-the-machine-we-are-investigating"><span class="toc-section-number">1</span> What is the Machine ID of the machine we are investigating?</a></li>
<li><a href="#what-backdoor-user-account-was-created-on-the-server"><span class="toc-section-number">2</span> What backdoor user account was created on the server?</a></li>
<li><a href="#what-is-the-cronjob-that-was-set-up-by-the-attacker-for-persistence"><span class="toc-section-number">3</span> What is the cronjob that was set up by the attacker for persistence?</a></li>
<li><a href="#examine-the-running-processes-on-the-machine.-can-you-identify-the-suspicious-looking-hidden-process-from-the-backdoor-account"><span class="toc-section-number">4</span> Examine the running processes on the machine. Can you identify the suspicious-looking hidden process from the backdoor account?</a></li>
<li><a href="#how-many-processes-are-found-to-be-running-from-the-backdoor-accounts-directory"><span class="toc-section-number">5</span> How many processes are found to be running from the backdoor account’s directory?</a></li>
<li><a href="#what-is-the-name-of-the-hidden-file-in-memory-from-the-root-directory"><span class="toc-section-number">6</span> What is the name of the hidden file in memory from the root directory?</a></li>
<li><a href="#what-suspicious-services-were-installed-on-the-server-format-is-service-a-service-b-in-alphabetical-order."><span class="toc-section-number">7</span> What suspicious services were installed on the server? Format is service a, service b in alphabetical order.</a></li>
<li><a href="#examine-the-logs-when-was-the-backdoor-account-created-on-this-infected-system"><span class="toc-section-number">8</span> Examine the logs; when was the backdoor account created on this infected system?</a></li>
<li><a href="#from-which-ip-address-were-multiple-ssh-connections-observed-against-the-suspicious-backdoor-account"><span class="toc-section-number">9</span> From which IP address were multiple SSH connections observed against the suspicious backdoor account?</a></li>
<li><a href="#how-many-failed-ssh-login-attempts-were-observed-on-the-backdoor-account"><span class="toc-section-number">10</span> How many failed SSH login attempts were observed on the backdoor account?</a></li>
<li><a href="#which-malicious-package-was-installed-on-the-host"><span class="toc-section-number">11</span> Which malicious package was installed on the host?</a></li>
<li><a href="#what-is-the-secret-code-found-in-the-metadata-of-the-suspicious-package"><span class="toc-section-number">12</span> What is the secret code found in the metadata of the suspicious package?</a></li>
<li><a href="#summary"><span class="toc-section-number">13</span> Summary</a></li>
</ul>
</nav>
<main>
<div class="card summary">
<h4>
Summary
</h4>
<hr>
<b><i class="fa-solid fa-box"></i> Source:</b> <a href='https://tryhackme.com/r/room/ironshade'>TryHackMe <i class="fa-solid fa-arrow-up-right-from-square"></i></a><br> <b><i class="fa-solid fa-signal"></i> Difficulty:</b> <span class="medium-diff">Medium</span><br>
</div>
<div class="card">
<h4>
Incident Scenario
</h4>
<hr>
<p>Based on the threat intel report received, an infamous hacking group, IronShade, has been observed targeting Linux servers across the region. Our team had set up a honeypot and exposed weak SSH and ports to get attacked by the APT group and understand their attack patterns. <br><br></p>
You are provided with one of the compromised Linux servers. Your task as a Security Analyst is to perform a thorough compromise assessment on the Linux server and identify the attack footprints. Some threat reports indicate that one indicator of their attack is creating a backdoor account for persistence.
</div>
<div class="card">
<h4>
Challenge
</h4>
<hr>
Investigate the server and identify the footprints left behind after the exploitation.
</div>
<h1 data-number="1" id="what-is-the-machine-id-of-the-machine-we-are-investigating"><span class="header-section-number">1</span> What is the Machine ID of the machine we are investigating?</h1>
<p><strong>Machine ID</strong> - value set during installation or boot. It uniquely identifies the host and should be considered confidential. It’s written in <em>/etc/machine-id</em>.</p>
<figure>
<img src="images/1.png" alt="" /><figcaption>Machine ID</figcaption>
</figure>
<h1 data-number="2" id="what-backdoor-user-account-was-created-on-the-server"><span class="header-section-number">2</span> What backdoor user account was created on the server?</h1>
<p>To list all accounts we can examine the <strong>/etc/passwd</strong> file.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a>$ <span class="fu">cat</span> /etc/passwd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>[<span class="ex">Output</span> ommited...]</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="ex">mircoservice</span>:x:1001:1001:,,,:/home/mircoservice:/bin/bash</span></code></pre></div>
<p>The last user in the file was <em>mircoservice</em>.</p>
<h1 data-number="3" id="what-is-the-cronjob-that-was-set-up-by-the-attacker-for-persistence"><span class="header-section-number">3</span> What is the cronjob that was set up by the attacker for persistence?</h1>
<p>In order to list cronjobs we can look at <strong>/etc/crontab</strong> or use <strong>crontab -l</strong>. <img src="images/2.png" alt="Listing cronjobs" /></p>
<pre><code>@reboot /home/mircoservice/printer_app</code></pre>
<p>Our job is listed on the bottom, <strong><span class="citation" data-cites="reboot">@reboot</span></strong> signifies that it will be run on each reboot.</p>
<h1 data-number="4" id="examine-the-running-processes-on-the-machine.-can-you-identify-the-suspicious-looking-hidden-process-from-the-backdoor-account"><span class="header-section-number">4</span> Examine the running processes on the machine. Can you identify the suspicious-looking hidden process from the backdoor account?</h1>
<p>We can use <strong>ps aux</strong>, to see running process, additionally we can filter for phrase <em>“mircoservice”</em> using <strong>grep</strong>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="ex">ubuntu@cybertees</span>:~$ ps aux <span class="kw">|</span> <span class="fu">grep</span> mircoservice</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="ex">root</span>         570  0.0  0.0   2364   580 ?        Ss   17:05   0:00 /home/mircoservice/.tmp/.strokes</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a><span class="ex">root</span>         876  0.0  0.0   2496    68 ?        S    17:05   0:00 /home/mircoservice/printer_app</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a><span class="ex">ubuntu</span>     10294  0.0  0.0   3444   724 pts/0    S+   17:15   0:00 grep --color=auto mircoservice</span></code></pre></div>
<p>As we can see there is one process that is hidden using the <em>“.”</em>, that’s <strong>.strokes</strong>.</p>
<h1 data-number="5" id="how-many-processes-are-found-to-be-running-from-the-backdoor-accounts-directory"><span class="header-section-number">5</span> How many processes are found to be running from the backdoor account’s directory?</h1>
<p>We can use the results of the last command to answer this question, remember not to count the <strong>grep</strong> command 😅.</p>
<h1 data-number="6" id="what-is-the-name-of-the-hidden-file-in-memory-from-the-root-directory"><span class="header-section-number">6</span> What is the name of the hidden file in memory from the root directory?</h1>
<p>This can be simply done using <strong>ls -la</strong>. <img src="images/3.png" alt="Listing files in root directory" /> There is one file - <strong>.systmd</strong>;</p>
<h1 data-number="7" id="what-suspicious-services-were-installed-on-the-server-format-is-service-a-service-b-in-alphabetical-order."><span class="header-section-number">7</span> What suspicious services were installed on the server? Format is service a, service b in alphabetical order.</h1>
<p>In order to search the services we can use:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a><span class="ex">systemctl</span> list-unit-files --type=service</span></code></pre></div>
<p>After some digging we can find two weird services.</p>
<p><img src="images/4.png" alt="Listing services" /> <img src="images/5.png" alt="Listing services" /></p>
<p>Those are <strong>backup.service</strong> and <strong>strokes.service</strong>;</p>
<h1 data-number="8" id="examine-the-logs-when-was-the-backdoor-account-created-on-this-infected-system"><span class="header-section-number">8</span> Examine the logs; when was the backdoor account created on this infected system?</h1>
<figure>
<img src="images/6.png" alt="" /><figcaption>Examining /var/log/auth.log</figcaption>
</figure>
<p>As a reminder <strong>/var/log/auth.log</strong> is the <strong>Authorization Log</strong> and contains information about <strong>authorization mechanisms</strong>, <strong>user names</strong> and usage of <strong>sudo</strong>. I will list below what more can we see in this file:</p>
<ul>
<li>login attempts (successful and failed)</li>
<li>data about network services</li>
<li>actions that require elevated privileges</li>
</ul>
<p>In order to filter logs we can use <strong>grep</strong> with an <strong>-a</strong> switch (because grep treats auth.log as a binary file) for the <em>useradd command</em>. The <strong>timestamp</strong> is the first thing we can read: <em>Aug 5 22:05:33</em>;</p>
<h1 data-number="9" id="from-which-ip-address-were-multiple-ssh-connections-observed-against-the-suspicious-backdoor-account"><span class="header-section-number">9</span> From which IP address were multiple SSH connections observed against the suspicious backdoor account?</h1>
<p>As I said before <em>auth.log</em> will contain network services information such as <strong>SSH connections</strong>. We will again use <strong>grep</strong> and search for <em>ssh</em>, we can grab the first event to find the IP address: <em>10.11.75.247</em>;</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a>$ <span class="fu">cat</span> /var/log/auth.log <span class="kw">|</span> <span class="fu">grep</span> -a ssh</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a><span class="bu">[</span> Output omitted...<span class="bu"> ]</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a><span class="ex">Aug</span> 13 22:16:12 cybertees sshd[2388]: PAM 2 more authentication failures<span class="kw">;</span> <span class="va">logname=</span> <span class="va">uid=</span>0 <span class="va">euid=</span>0 <span class="va">tty=</span>ssh <span class="va">ruser=</span> <span class="va">rhost=</span>10.11.75.247  <span class="va">user=</span>mircoservice</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a><span class="bu">[</span> Output omitted...]</span></code></pre></div>
<h1 data-number="10" id="how-many-failed-ssh-login-attempts-were-observed-on-the-backdoor-account"><span class="header-section-number">10</span> How many failed SSH login attempts were observed on the backdoor account?</h1>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="ex">root@cybertees</span>:/# cat /var/log/auth.log <span class="kw">|</span> <span class="fu">grep</span> -a <span class="st">&quot;ssh&quot;</span> <span class="kw">|</span> <span class="fu">grep</span> -a <span class="st">&quot;mircoservice&quot;</span> <span class="kw">|</span> <span class="fu">grep</span> -a <span class="st">&quot;Fail&quot;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a><span class="ex">Aug</span>  6 01:16:43 cybertees sshd[2256]: Failed password for mircoservice from 10.11.75.247 port 54649 ssh2</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a><span class="ex">Aug</span>  6 01:17:14 cybertees sshd[2256]: Failed password for mircoservice from 10.11.75.247 port 54649 ssh2</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a><span class="ex">Aug</span> 13 22:15:08 cybertees sshd[2385]: Failed password for mircoservice from 10.11.75.247 port 64855 ssh2</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a><span class="ex">Aug</span> 13 22:15:16 cybertees sshd[2385]: message repeated 2 times: [ Failed password for mircoservice from 10.11.75.247 port 64855 ssh2]</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a><span class="ex">Aug</span> 13 22:15:44 cybertees sshd[2388]: Failed password for mircoservice from 10.11.75.247 port 64871 ssh2</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a><span class="ex">Aug</span> 13 22:16:12 cybertees sshd[2388]: message repeated 2 times: [ Failed password for mircoservice from 10.11.75.247 port 64871 ssh2]</span></code></pre></div>
<p>We can <strong>chain multiple grep</strong> commands to find the proper logs. There were <em>8 failed SSH login attempts.</em></p>
<h1 data-number="11" id="which-malicious-package-was-installed-on-the-host"><span class="header-section-number">11</span> Which malicious package was installed on the host?</h1>
<figure>
<img src="images/7.png" alt="" /><figcaption>Searching for malicious packages</figcaption>
</figure>
<p>We can search for installation of packages using <em>/var/log/dpkg.log</em> and filter for <em>“install”</em> keyword using <strong>grep</strong>. One package seems out of the ordinary: <strong>pscanner</strong>.</p>
<h1 data-number="12" id="what-is-the-secret-code-found-in-the-metadata-of-the-suspicious-package"><span class="header-section-number">12</span> What is the secret code found in the metadata of the suspicious package?</h1>
<figure>
<img src="images/8.png" alt="" /><figcaption>Reading the metadata of the package</figcaption>
</figure>
<p>To view the details of a package we can use <strong>apt show</strong>; Our flag is written in the <em>package’s description</em>.</p>
<h1 data-number="13" id="summary"><span class="header-section-number">13</span> Summary</h1>
This challenge required us to thoroughly examine several system components, including system logs, cron jobs, and the file structure, to uncover signs of malicious activity. We also investigated running services and application packages to identify any unauthorized or compromised elements introduced during the exploitation.
</main>
<div class="footer">
    <p>Made by Aleksander Jóźwik</p>
</div>
</body>
</html>
